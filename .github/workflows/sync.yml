name: Sync From Git To Azure

on: 
  push:
    branches: [main]
    
jobs:
  sync_from_git_to_azure:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: Setup environment variables
      run: |
        echo "name=AZUREPAT::${{ secrets.AZUREPAT }} >> GITHUB_ENV
        echo "name=AZUSERNAME::${{ secrets.AZUSERNAME }} >> GITHUB_ENV
        echo "name=AZUSER_EMAIL::${{ secrets.AZUSER_EMAIL }} >> GITHUB_ENV
        echo "name=AZORG::${{ secrets.AZORG }} >> $GITHUB_ENV
    - name: Git clone repo
      run: |
        git clone https://github.com/AlekWithK/BuildManager
        cd BuildManager
        rm -rf .git
    - name: Clone to Azure DevOps Repo
      run: |
        cd ..
        GIT_CMD_REPOSITORY="https://$AZUSERNAME:$AZUREPAT@dev.azure.com/$AZORG/_git/BuildManager" 
        rm -rf $GIT_CMD_REPOSITORY
        git clone $GIT_CMD_REPOSITORY
    - name: Copy files from git repro to azure repro
      run: |
        rm -rf /BuildManager
        yes | cp -rf BuildManager/* BuildManager/
    - name: Configure user in azure repro
      run: |
        cd BuildManager
        git config --global user.email "$AZUSER_EMAIL"
        git config --global user.name "$AZUSERNAME"
    - name: Commit and Push to azure
      run: |
        git add .
        git commit -m "sync from git to azure"
        git push
